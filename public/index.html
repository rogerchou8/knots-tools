<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <title>èŠ‚ç‚¹å·¥å…·åˆé›†</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      height: 100vh;
    }

    nav {
      width: 200px;
      background: #f8f8f8;
      border-right: 1px solid #ddd;
      padding: 1em;
    }

    nav h2 {
      font-size: 1.2em;
      margin-bottom: 1em;
    }

    nav ul {
      list-style: none;
      padding: 0;
    }

    nav li {
      margin: 0.5em 0;
      cursor: pointer;
      color: #0077cc;
    }

    nav li:hover {
      text-decoration: underline;
    }

    main {
      flex: 1;
      padding: 2em;
      overflow-y: auto;
    }

    section {
      display: none;
    }

    section.active {
      display: block;
    }

    textarea {
      width: 100%;
      margin: 0.5em 0;
      height: 200px;
    }

    input {
      width: 100%;
      margin: 0.5em 0;
    }

    button {
      margin: 0.5em 0;
      padding: 0.5em 1em;
      cursor: pointer;
    }

    pre {
      background: #f0f0f0;
      padding: 1em;
      white-space: pre-wrap;
      word-break: break-all;
      overflow-x: auto;
      overflow-y: auto;
      max-height: 300px;
      border: 1px solid #ccc;
      margin-bottom: 0.5em;
    }
  </style>
</head>

<body>
  <nav>
    <h2>ğŸŒ å·¥å…·èœå•</h2>
    <ul>
      <li onclick="switchTab('gen')">1ï¸âƒ£ èŠ‚ç‚¹ç”Ÿæˆ</li>
      <li onclick="switchTab('fofa')">2ï¸âƒ£ FOFA IP æå–</li>
      <li onclick="switchTab('extract')">3ï¸âƒ£ èŠ‚ç‚¹æå– IP</li>
    </ul>
  </nav>
  <main>
    <section id="gen" class="active">
      <h3>1ï¸âƒ£ vlessèŠ‚ç‚¹ç”Ÿæˆ</h3>
      <input id="tpl" placeholder="vless://id@1.1.1.1:443?...">
      <textarea id="ips" placeholder="æ¯è¡Œä¸€ä¸ª IP åœ°å€"></textarea>
      <button onclick="genKnots()">ç”ŸæˆèŠ‚ç‚¹</button>
      <pre id="out1"></pre>
      <button onclick="copyToClipboard('out1')">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
    </section>

    <section id="fofa">
      <h3>2ï¸âƒ£ æå– FOFA IP</h3>
      <textarea id="fofa" placeholder="ç²˜è´´ FOFA JSON å“åº”"></textarea>
      <button onclick="parseFofa()">æå– IP</button>
      <pre id="out2"></pre>
      <button onclick="copyToClipboard('out2')">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
    </section>

    <section id="extract">
      <h3>3ï¸âƒ£ ä»vlessèŠ‚ç‚¹ä¸­æå– IP</h3>
      <textarea id="knots" placeholder="ç²˜è´´å¤šä¸ªèŠ‚ç‚¹"></textarea>
      <button onclick="extractIP()">æå–</button>
      <pre id="out3"></pre>
      <button onclick="copyToClipboard('out3')">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
    </section>
  </main>

  <script>
    function switchTab(id) {
      document.querySelectorAll("main section").forEach(s => s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    async function genKnots() {
      const tpl = document.getElementById('tpl').value;
      const ips = document.getElementById('ips').value;
      const res = await fetch(`/knots?basicKnot=${encodeURIComponent(tpl)}`, {
        method: "POST", body: ips
      });
      document.getElementById('out1').textContent = await res.text();
    }

    async function parseFofa() {
      const body = document.getElementById('fofa').value;
      const res = await fetch('/fofa-ip', { method: "POST", body });
      document.getElementById('out2').textContent = await res.text();
    }

    async function extractIP() {
      const nodes = document.getElementById('knots').value;
      const res = await fetch('/knots2IP', { method: "POST", body: nodes });
      document.getElementById('out3').textContent = await res.text();
    }

    function copyToClipboard(preId) {
      const text = document.getElementById(preId).textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert("âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿");
      }).catch(err => {
        alert("âŒ å¤åˆ¶å¤±è´¥ï¼š" + err);
      });
    }
  </script>
</body>

</html>